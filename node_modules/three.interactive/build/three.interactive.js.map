{
  "version": 3,
  "sources": ["../src/index.ts"],
  "sourcesContent": ["import { Raycaster, Vector2 } from 'three';\n\nexport class InteractiveObject {\n  target: THREE.Object3D;\n  name: string;\n  intersected: boolean;\n  wasIntersected: boolean = false;\n  distance: number;\n  constructor(target: THREE.Object3D, name: string) {\n    this.target = target;\n    this.name = name;\n    this.intersected = false;\n    this.distance = 0;\n  }\n}\n\nexport class InteractiveEvent {\n  type: string;\n  cancelBubble: boolean;\n  originalEvent: Event | null;\n\n  // Dummy default values\n  coords: Vector2 = new Vector2(0, 0);\n  distance: number = 0;\n  intersected: boolean = false;\n\n  constructor(type: string, originalEvent: Event | null = null) {\n    this.cancelBubble = false;\n    this.type = type;\n    this.originalEvent = originalEvent;\n  }\n  stopPropagation() {\n    this.cancelBubble = true;\n  }\n}\n\nexport class InteractionManager {\n  renderer: THREE.Renderer;\n  camera: THREE.Camera;\n  domElement: HTMLElement;\n  bindEventsOnBodyElement: boolean;\n  mouse: Vector2;\n  supportsPointerEvents: boolean;\n  interactiveObjects: InteractiveObject[];\n  closestObject: InteractiveObject | null;\n  raycaster: THREE.Raycaster;\n\n  treatTouchEventsAsMouseEvents: boolean;\n\n  constructor(\n    renderer: THREE.Renderer,\n    camera: THREE.Camera,\n    domElement: HTMLElement,\n    dontBindEventsOnBody: boolean | undefined\n  ) {\n    this.renderer = renderer;\n    this.camera = camera;\n    this.domElement = domElement;\n    this.bindEventsOnBodyElement = true;\n    if (typeof dontBindEventsOnBody !== 'undefined' && dontBindEventsOnBody) {\n      this.bindEventsOnBodyElement = false;\n    }\n\n    this.mouse = new Vector2(-1, 1); // top left default position\n\n    this.supportsPointerEvents = !!window.PointerEvent;\n\n    this.interactiveObjects = [];\n    this.closestObject = null;\n\n    this.raycaster = new Raycaster();\n\n    domElement.addEventListener('click', this.onMouseClick);\n\n    if (this.supportsPointerEvents) {\n      if (this.bindEventsOnBodyElement) {\n        domElement.ownerDocument.addEventListener(\n          'pointermove',\n          this.onDocumentMouseMove\n        );\n      } else {\n        domElement.addEventListener('pointermove', this.onDocumentMouseMove);\n      }\n      domElement.addEventListener('pointerdown', this.onMouseDown);\n      domElement.addEventListener('pointerup', this.onMouseUp);\n    } else {\n      if (this.bindEventsOnBodyElement) {\n        domElement.ownerDocument.addEventListener(\n          'mousemove',\n          this.onDocumentMouseMove\n        );\n      } else {\n        domElement.addEventListener('mousemove', this.onDocumentMouseMove);\n      }\n      domElement.addEventListener('mousedown', this.onMouseDown);\n      domElement.addEventListener('mouseup', this.onMouseUp);\n      domElement.addEventListener('touchstart', this.onTouchStart, {\n        passive: true,\n      });\n      domElement.addEventListener('touchmove', this.onTouchMove, {\n        passive: true,\n      });\n      domElement.addEventListener('touchend', this.onTouchEnd, {\n        passive: true,\n      });\n    }\n\n    this.treatTouchEventsAsMouseEvents = true;\n  }\n\n  dispose = () => {\n    this.domElement.removeEventListener('click', this.onMouseClick);\n\n    if (this.supportsPointerEvents) {\n      this.domElement.ownerDocument.removeEventListener(\n        'pointermove',\n        this.onDocumentMouseMove\n      );\n      this.domElement.removeEventListener('pointerdown', this.onMouseDown);\n      this.domElement.removeEventListener('pointerup', this.onMouseUp);\n    } else {\n      this.domElement.ownerDocument.removeEventListener(\n        'mousemove',\n        this.onDocumentMouseMove\n      );\n      this.domElement.removeEventListener('mousedown', this.onMouseDown);\n      this.domElement.removeEventListener('mouseup', this.onMouseUp);\n      this.domElement.removeEventListener('touchstart', this.onTouchStart);\n      this.domElement.removeEventListener('touchmove', this.onTouchMove);\n      this.domElement.removeEventListener('touchend', this.onTouchEnd);\n    }\n  };\n\n  add = (object: THREE.Object3D, childNames: string[] = []) => {\n    if (object) {\n      if (childNames.length > 0) {\n        childNames.forEach((name) => {\n          const o = object.getObjectByName(name);\n          if (o) {\n            const interactiveObject = new InteractiveObject(o, name);\n            this.interactiveObjects.push(interactiveObject);\n          }\n        });\n      } else {\n        const interactiveObject = new InteractiveObject(object, object.name);\n        this.interactiveObjects.push(interactiveObject);\n      }\n    }\n  };\n\n  remove = (object: THREE.Object3D, childNames: string[] = []) => {\n    if (!object) return;\n    const filterSet = new Set<string>(\n      childNames.length > 0 ? childNames : [object.name]\n    );\n\n    this.interactiveObjects = this.interactiveObjects.filter(\n      (o) => !filterSet.has(o.name)\n    );\n  };\n\n  update = () => {\n    this.raycaster.setFromCamera(this.mouse, this.camera);\n\n    // console.log( scene.children );\n\n    this.interactiveObjects.forEach((object) => {\n      if (object.target) this.checkIntersection(object);\n    });\n\n    this.interactiveObjects.sort(function (a, b) {\n      return a.distance - b.distance;\n    });\n\n    const newClosestObject =\n      this.interactiveObjects.find((object) => object.intersected) ?? null;\n    if (newClosestObject != this.closestObject) {\n      if (this.closestObject) {\n        const eventOutClosest = new InteractiveEvent('mouseout');\n        this.dispatch(this.closestObject, eventOutClosest);\n      }\n      if (newClosestObject) {\n        const eventOverClosest = new InteractiveEvent('mouseover');\n        this.dispatch(newClosestObject, eventOverClosest);\n      }\n      this.closestObject = newClosestObject;\n    }\n\n    let eventLeave: InteractiveEvent;\n    this.interactiveObjects.forEach((object) => {\n      if (!object.intersected && object.wasIntersected) {\n        if (!eventLeave) {\n          eventLeave = new InteractiveEvent('mouseleave');\n        }\n        this.dispatch(object, eventLeave);\n      }\n    });\n    let eventEnter: InteractiveEvent;\n    this.interactiveObjects.forEach((object) => {\n      if (object.intersected && !object.wasIntersected) {\n        if (!eventEnter) {\n          eventEnter = new InteractiveEvent('mouseenter');\n        }\n        this.dispatch(object, eventEnter);\n      }\n    });\n  };\n\n  checkIntersection = (object: InteractiveObject) => {\n    const intersects = this.raycaster.intersectObjects([object.target], true);\n\n    object.wasIntersected = object.intersected;\n\n    if (intersects.length > 0) {\n      let distance = intersects[0].distance;\n      intersects.forEach((i) => {\n        if (i.distance < distance) {\n          distance = i.distance;\n        }\n      });\n      object.intersected = true;\n      object.distance = distance;\n    } else {\n      object.intersected = false;\n    }\n  };\n\n  onDocumentMouseMove = (mouseEvent: MouseEvent | PointerEvent) => {\n    // event.preventDefault();\n\n    this.mapPositionToPoint(this.mouse, mouseEvent.clientX, mouseEvent.clientY);\n\n    const event = new InteractiveEvent('mousemove', mouseEvent);\n\n    this.interactiveObjects.forEach((object) => {\n      this.dispatch(object, event);\n    });\n  };\n\n  onTouchMove = (touchEvent: TouchEvent) => {\n    // event.preventDefault();\n\n    this.mapPositionToPoint(\n      this.mouse,\n      touchEvent.touches[0].clientX,\n      touchEvent.touches[0].clientY\n    );\n\n    const event = new InteractiveEvent(\n      this.treatTouchEventsAsMouseEvents ? 'mousemove' : 'touchmove',\n      touchEvent\n    );\n\n    this.interactiveObjects.forEach((object) => {\n      this.dispatch(object, event);\n    });\n  };\n\n  onMouseClick = (mouseEvent: MouseEvent) => {\n    this.update();\n\n    const event = new InteractiveEvent('click', mouseEvent);\n\n    this.interactiveObjects.forEach((object) => {\n      if (object.intersected) {\n        this.dispatch(object, event);\n      }\n    });\n  };\n\n  onMouseDown = (mouseEvent: MouseEvent | PointerEvent) => {\n    this.mapPositionToPoint(this.mouse, mouseEvent.clientX, mouseEvent.clientY);\n\n    this.update();\n\n    const event = new InteractiveEvent('mousedown', mouseEvent);\n\n    this.interactiveObjects.forEach((object) => {\n      if (object.intersected) {\n        this.dispatch(object, event);\n      }\n    });\n  };\n\n  onTouchStart = (touchEvent: TouchEvent) => {\n    this.mapPositionToPoint(\n      this.mouse,\n      touchEvent.touches[0].clientX,\n      touchEvent.touches[0].clientY\n    );\n\n    this.update();\n\n    const event = new InteractiveEvent(\n      this.treatTouchEventsAsMouseEvents ? 'mousedown' : 'touchstart',\n      touchEvent\n    );\n\n    this.interactiveObjects.forEach((object) => {\n      if (object.intersected) {\n        this.dispatch(object, event);\n      }\n    });\n  };\n\n  onMouseUp = (mouseEvent: MouseEvent | PointerEvent) => {\n    const event = new InteractiveEvent('mouseup', mouseEvent);\n\n    this.interactiveObjects.forEach((object) => {\n      this.dispatch(object, event);\n    });\n  };\n\n  onTouchEnd = (touchEvent: TouchEvent) => {\n    this.mapPositionToPoint(\n      this.mouse,\n      touchEvent.touches[0].clientX,\n      touchEvent.touches[0].clientY\n    );\n\n    this.update();\n\n    const event = new InteractiveEvent(\n      this.treatTouchEventsAsMouseEvents ? 'mouseup' : 'touchend',\n      touchEvent\n    );\n\n    this.interactiveObjects.forEach((object) => {\n      this.dispatch(object, event);\n    });\n  };\n\n  dispatch = (object: InteractiveObject, event: InteractiveEvent) => {\n    if (object.target && !event.cancelBubble) {\n      event.coords = this.mouse;\n      event.distance = object.distance;\n      event.intersected = object.intersected;\n      object.target.dispatchEvent(event);\n    }\n  };\n\n  mapPositionToPoint = (point: Vector2, x: number, y: number) => {\n    const rect = this.renderer.domElement.getBoundingClientRect();\n\n    point.x = ((x - rect.left) / rect.width) * 2 - 1;\n    point.y = -((y - rect.top) / rect.height) * 2 + 1;\n  };\n}\n"],
  "mappings": "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",
  "names": []
}
